os: linux
dist: trusty
sudo: false
group: edge

language: python
python:
- 2.6
- 2.7
- 3.3
- 3.4
- 3.5
- &mainstream_python 3.6
- nightly

install:
- travis_retry pip install --pre -e .[testing,webassets]

script:
- nosetests -v --with-coverage --cover-package=dukpy --cover-erase

after_success:
- coveralls

stages:
- test
- name: deploy
  if: tag IS present

jobs:
  fast_finish: true
  allow_failures:
  - python: nightly
  include:
  - stage: deploy
    python: *mainstream_python
    install: skip
    script: skip
    deploy:
      provider: pypi
      on:
        tags: true
        all_branches: true
      user: amol-
      # just source dist, because binary wheel requires extra work
      distributions: sdist
      password:
        secure: YOUR_ENCRYPTED_PASSWORD_HERE
